{% extends "app/base/base_logged_in.html" %}

{% block CSSblock %}
    {% load static %}
    <link rel="stylesheet" href="{% static 'app/stylesheets/public/index.css' %}">
{% endblock %}

{% block main %}
    <div class="container">
        <div class="row justify-content-md-center">
            <div id="container" style="width:100%; height:40vh;"></div>
        </div>
        <div class="row justify-content-md-center">
            <div class="col-md-6">
                <div class="row">
                    <h2>Current power: {{ current_power }}W</h2>
                </div>
                <div class="row">
                    <h2>Energy today: {{ energy_day }}kWh</h2>
                </div>
                <div class="row">
                    <h2>Energy this month: {{ energy_month }}kWh</h2>
                </div>
                <div class="row">
                    <h2>Energy this year: {{ energy_year }}kWh</h2>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            $.getJSON('/json/power', function(data) {
                const rawData = data['power']['raw'];

                const myChart = Highcharts.chart('container', {
                    chart: {
                        type: 'spline',
                        zoomType: 'x',
                        scrollablePlotArea: {
                            minWidth: 200,
                            scrollPositionX: 1
                        }
                    },
                    title: {
                        text: ''
                    },
                    xAxis: {
                        type: 'datetime',
                        labels: '',
                        lineWidth: 0,
                        tickLength: 0
                    },
                    yAxis: {
                        title: {
                            text: ''
                        },
                        labels: '',
                        gridLineWidth: 0
                    },
                    tooltip: {
                        valueSuffix: ' kWh',
                        shared: true
                    },
                    legend: {
                        enabled: false
                    },
                    plotOptions: {
                        spline: {
                            lineWidth: 2,
                            marker: {
                                enabled: false
                            },
                            enableMouseTracking: false
                        }
                    },
                    series: [{
                        name: rawData['name'],
                        data: rawData['data'],
                        color: 'grey',
                    }]
                });
            })
        })
    </script>
{% endblock %}
